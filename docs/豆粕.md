# 策略分析与原理讲解
根据描述，该豆粕 ETF 策略的核心是通过 "移仓换月" 机制复制大商所豆粕价格指数，主要赚取两部分收益：通货膨胀带来的商品价值增长和期货合约移仓换月时的贴水补偿，同时承担豆粕价格本身的随机波动风险。

## 策略核心原理：

1. 移仓换月机制：当近月合约即将到期时，平仓近月合约并同时开仓远月合约，复制豆粕价格指数走势
2. 贴水补偿收益：豆粕远月合约通常价格低于近月合约（正向市场结构），移仓时可获得价差收益
3. 抗通胀属性：作为实物商品，豆粕价格会随通货膨胀上涨，提供通胀保护

## 策略优势：

- 不依赖豆粕价格长期上涨，通过移仓机制获取稳定的贴水收益
- 商品属性天然抵御通货膨胀
- 操作简单透明，复制指数走势，减少主观判断

## 策略实现代码

以下是基于 Python 的豆粕 ETF 移仓换月策略实现，模拟了跟踪豆粕指数并进行移仓换月的核心逻辑：

```python
import pandas as pd
import numpy as np
import datetime as dt

class SoybeanMealETFStrategy:
    def __init__(self):
        """初始化豆粕ETF策略"""
        self.positions = {}  # 持仓合约及数量
        self.cash = 1000000  # 初始资金
        self.history = []    # 历史记录
        self.index_track_error = []  # 跟踪误差记录
        
    def get_contracts(self, date):
        """
        获取指定日期的豆粕合约列表
        实际应用中应从交易所API获取真实合约数据
        """
        # 模拟合约数据：合约代码、到期日、当前价格
        year = date.year
        month_codes = ['M', 'P', 'Y', 'C', 'F', 'H', 'K', 'N', 'Q', 'U', 'V', 'X']
        
        contracts = []
        for i in range(12):
            month = (date.month + i) % 12
            if month == 0:
                month = 12
                contract_year = year + 1
            else:
                contract_year = year if (date.month + i) <= 12 else year + 1
                
            code = f"M{str(contract_year)[-2]}{month_codes[month-1]}"
            expiry_date = dt.datetime(contract_year, month, 15)  # 假设每月15日为到期日
            if expiry_date > date:  # 只保留未到期合约
                # 模拟价格：远月合约通常有贴水，价格随到期日增加而略有降低
                price = 4000 - (i * 20) + np.random.normal(0, 50)
                contracts.append({
                    'code': code,
                    'expiry_date': expiry_date,
                    'price': round(price, 2),
                    'days_to_expiry': (expiry_date - date).days
                })
        
        return sorted(contracts, key=lambda x: x['expiry_date'])
    
    def check_roll_need(self, date, contracts):
        """检查是否需要移仓换月（通常在近月合约到期前15天）"""
        if not contracts:
            return False
            
        nearest_contract = contracts[0]
        # 如果近月合约距离到期日小于15天，则需要移仓
        return nearest_contract['days_to_expiry'] <= 15
    
    def roll_position(self, date):
        """执行移仓换月操作"""
        contracts = self.get_contracts(date)
        if len(contracts) < 2:  # 需要至少两个合约才能移仓
            return False
            
        nearest_contract = contracts[0]
        next_contract = contracts[1]
        
        # 如果持有近月合约，则平仓
        if nearest_contract['code'] in self.positions:
            quantity = self.positions[nearest_contract['code']]
            # 平仓收入
            self.cash += quantity * nearest_contract['price']
            del self.positions[nearest_contract['code']]
            
            # 开仓远月合约，使用平仓所得资金
            new_quantity = int(self.cash / next_contract['price'] / 10) * 10  # 按10吨一手
            if new_quantity > 0:
                self.positions[next_contract['code']] = new_quantity
                self.cash -= new_quantity * next_contract['price']
                
                # 记录移仓操作
                self.history.append({
                    'date': date,
                    'action': 'roll',
                    'from_contract': nearest_contract['code'],
                    'to_contract': next_contract['code'],
                    'quantity': new_quantity,
                    'cash': self.cash,
                    'pnl': (quantity * nearest_contract['price']) - (new_quantity * next_contract['price'])
                })
                return True
        return False
    
    def rebalance(self, date):
        """每日调仓逻辑：检查是否需要移仓，否则保持仓位"""
        contracts = self.get_contracts(date)
        
        # 如果没有持仓，则建仓近月合约
        if not self.positions and contracts:
            nearest_contract = contracts[0]
            quantity = int(self.cash / nearest_contract['price'] / 10) * 10
            if quantity > 0:
                self.positions[nearest_contract['code']] = quantity
                self.cash -= quantity * nearest_contract['price']
                self.history.append({
                    'date': date,
                    'action': 'open',
                    'contract': nearest_contract['code'],
                    'quantity': quantity,
                    'cash': self.cash
                })
        else:
            # 检查是否需要移仓
            if self.check_roll_need(date, contracts):
                self.roll_position(date)
    
    def calculate_nav(self, date):
        """计算净值"""
        contracts = {c['code']: c for c in self.get_contracts(date)}
        position_value = 0
        for code, quantity in self.positions.items():
            if code in contracts:
                position_value += quantity * contracts[code]['price']
        
        # 计算豆粕指数值（模拟）
        index_value = sum(c['price'] * (1 - i*0.05) for i, c in enumerate(contracts.values())) / len(contracts)
        
        # 记录跟踪误差
        portfolio_value = position_value + self.cash
        self.index_track_error.append({
            'date': date,
            'portfolio_value': portfolio_value,
            'index_value': index_value,
            'tracking_error': abs(portfolio_value / 10000 - index_value)  # 简化的跟踪误差计算
        })
        
        return portfolio_value
    
    def run_backtest(self, start_date, end_date):
        """回测策略"""
        current_date = start_date
        while current_date <= end_date:
            # 只在交易日运行（简单模拟：周一至周五）
            if current_date.weekday() < 5:
                self.rebalance(current_date)
                self.calculate_nav(current_date)
            
            current_date += dt.timedelta(days=1)
        
        # 返回回测结果
        return {
            'history': pd.DataFrame(self.history),
            'tracking_errors': pd.DataFrame(self.index_track_error),
            'final_nav': self.calculate_nav(end_date)
        }

# 运行策略示例
if __name__ == "__main__":
    # 初始化策略
    strategy = SoybeanMealETFStrategy()
    
    # 回测时间段：1年
    start = dt.datetime(2023, 1, 1)
    end = dt.datetime(2023, 12, 31)
    
    # 运行回测
    results = strategy.run_backtest(start, end)
    
    # 输出结果
    print(f"初始资金: 1,000,000")
    print(f"最终净值: {results['final_nav']:.2f}")
    print(f"总收益: {results['final_nav'] - 1000000:.2f}")
    print(f"年化收益率: {((results['final_nav'] / 1000000) **(1/1) - 1) * 100:.2f}%")
    
    # 输出移仓记录
    print("\n移仓记录:")
    print(results['history'][['date', 'action', 'from_contract', 'to_contract', 'pnl']])

```

## 代码说明
该策略代码实现了豆粕 ETF 的核心功能：

1. **合约管理**：get_contracts方法模拟生成豆粕期货合约数据，包含合约代码、到期日和价格等信息
2. **移仓逻辑**：
    - check_roll_need判断是否需要移仓（近月合约到期前 15 天）
    - roll_position执行移仓操作，平掉近月合约同时开仓远月合约
    - 移仓时自动计算可开仓数量，保持仓位规模相对稳定
3. **净值计算**：calculate_nav每日计算组合净值，并跟踪与豆粕指数的偏差
4. **回测系统**：run_backtest函数可对策略进行历史回测，输出收益情况和移仓记录

实际应用时，需要将模拟的合约数据替换为真实的交易所数据接口，并根据实际情况调整移仓参数（如移仓提前天数）。策略的收益主要来源于移仓时的贴水（当远月价格低于近月时）和豆粕价格随通胀的上涨，同时会承担市场波动风险。

# 如何理解“豆粕远月合约通常价格低于近月合约（正向市场结构），移仓时可获得价差收益”

要理解 “豆粕远月合约价低于近月合约（正向市场结构）时，移仓可获价差收益”，需要先拆解商品期货市场结构的核心逻辑，再结合豆粕的品种特性和移仓操作细节，逐步厘清收益的来源。以下从基础概念、豆粕正向结构的成因、移仓收益的实现过程三个维度详细解释：

## 一、先明确核心概念：什么是 “正向市场结构”？

商品期货的 “市场结构”，本质是**不同到期月份合约的价格关系**，主要分为两种：

| 市场结构类型|	定义（近月合约 vs 远月合约）|	核心逻辑	|常见场景|
|---|---|---|---|
|正向市场（Backwardation）	|近月价格 > 远月价格	|市场对 “近期商品” 的需求更迫切，或近期供给更紧张，愿意为 “即时获取商品” 支付更高价格	|供需缺口、库存低位、短期消费旺季|
|反向市场（Contango）|	近月价格 < 远月价格|	市场预期远期供给紧张，或持有商品需承担仓储、资金等成本（“持有成本” 主导），远月需包含这些成本|	库存高位、供给过剩、长期供需矛盾|

你提到的 “豆粕远月合约价低于近月合约”，正是典型的**正向市场结构（Backwardation）** —— 这是理解移仓收益的前提。

## 二、关键：为什么豆粕常出现 “正向市场结构”？

豆粕的供给和需求特性，决定了它更容易在特定阶段呈现 “近月价高、远月价低”，核心原因可归纳为 3 点：

1. **供给的 “季节性缺口”**
豆粕是大豆压榨的副产品（大豆→78% 豆粕 + 20% 豆油），而大豆的供给高度依赖进口（中国大豆进口量占消费的 85% 以上，主要来自美国、巴西、阿根廷），且进口存在季节性窗口期：

- 每年 10-12 月：巴西新豆上市，大豆进口量激增，压榨量提升→豆粕短期供给充足，近月价格可能回落；
- 每年 5-8 月：巴西豆库存消耗殆尽，美国新豆未上市（“青黄不接”），大豆进口量下降→压榨量减少，豆粕短期供给缺口→市场愿意为 “近期能拿到的豆粕” 支付更高价格，近月合约价 > 远月合约价。

这种 “季节性供需错配” 是豆粕正向结构最核心的成因。

2. **需求的 “刚性与即时性”**
豆粕的主要需求是饲料养殖（占消费的 90% 以上，用于猪、鸡、水产养殖） ，而养殖企业的需求具有 “即时性”：

- 养殖需要持续投喂，企业无法等待远月合约（否则会导致牲畜断粮），必须采购近月合约来满足当前生产；
- 即使远月合约更便宜，养殖企业也不会大量囤积（因为豆粕存储需要仓库、防潮设备，且存储时间过长会导致蛋白含量下降，反而增加成本）。

因此，近月合约始终有 “刚性需求支撑”，价格难以低于远月。

3. **库存的 “低水平强化正向结构”**

当豆粕库存处于低位时（如季节性供给缺口期），市场对 “近期缺货” 的担忧会加剧 —— 近月合约因 “现货可交割”，价格会紧贴现货价；而远月合约因预期未来供给会恢复（如美国新豆上市），价格会低于近月。这种 “库存低位→现货强、远期弱” 的逻辑，进一步强化了正向市场结构。

## 三、核心操作：移仓如何赚到 “价差收益”？
在正向市场结构下（近月价 > 远月价），豆粕 ETF 的 “移仓换月” 本质是 **“卖出高价的近月合约，买入低价的远月合约”** ，这个过程中自然产生价差收益。具体分 3 步拆解（结合实例更易理解）：

1. 移仓的前提：期货合约的 “到期属性”

商品期货合约有固定到期日（如豆粕期货合约代码为 M2409，代表 2024 年 9 月到期），到期后必须交割（或提前平仓），无法像股票一样长期持有。因此，跟踪 “豆粕价格指数” 的 ETF，需要在合约到期前卖出即将到期的近月合约，买入下一个主力合约（通常是远月合约） ，这个操作就是 “移仓换月”。

2. 正向结构下的移仓收益实例

假设当前是 2024 年 7 月，豆粕处于正向市场，具体价格如下：

- 近月合约：M2409（9 月到期），价格 3800 元 / 吨（即将到期，是当前主力合约）；
- 远月合约：M2411（11 月到期），价格 3650 元 / 吨（远月价低于近月，价差 150 元 / 吨）。

ETF 当前持有 1 手 M2409 合约（1 手 = 10 吨），需在 8 月（到期前 1 个月）移仓，操作步骤：

- 卖出近月合约（M2409） ：以 3800 元 / 吨卖出 1 手，获得资金 = 3800 元 / 吨 × 10 吨 = 38000 元；
- 买入远月合约（M2411） ：以 3650 元 / 吨买入 1 手，花费资金 = 3650 元 / 吨 × 10 吨 = 36500 元；
- 计算价差收益 ：卖出收入 - 买入成本 = 38000 元 - 36500 元 = 1500 元 / 手。

这个 1500 元的收益，就是正向市场结构下 “移仓换月” 带来的价差收益—— 本质是 “用高价卖、低价买” 的价差盈利。

3. 收益的可持续性：只要正向结构延续，收益就会重复
只要豆粕的正向市场结构没有改变（近月始终高于远月），每次移仓都会重复 “高卖低买” 的过程，持续获得价差收益。

例如，到了 2024 年 10 月，M2411 成为近月合约（价格 3700 元 / 吨），下一个远月合约 M2501 价格 3550 元 / 吨（仍为正向结构），ETF 再次移仓：

- 卖出 M2411（3700 元 / 吨），买入 M2501（3550 元 / 吨）；
- 再次获得价差收益：（3700-3550）×10 = 1500 元 / 手。

## 四、关键提醒：移仓收益不是 “无风险” 的

虽然正向市场下移仓能获得价差收益，但需注意两个前提，否则收益可能消失甚至转为亏损：

1. **市场结构必须是正向（Backwardation）**：如果豆粕进入反向市场（近月价 <远月价），移仓时就会变成 “低价卖近月、高价买远月”，产生价差亏损（这也是商品 ETF 的主要风险之一）；
2. **移仓成本需覆盖**：实际操作中会产生手续费、滑点（买卖价格与预期的偏差）等成本，只有当价差收益 > 移仓成本时，才能获得实际盈利。

## 总结

“豆粕远月价低于近月（正向市场），移仓获价差收益” 的核心逻辑可简化为：

1. 豆粕的季节性供需缺口、刚性即时需求，导致近月合约价 > 远月合约价（正向结构）；
2. ETF 为跟踪指数，必须在近月合约到期前 “高卖近月、低买远月”；
3. 买卖价差就是移仓收益，只要正向结构延续，收益可重复获取。

# 对于豆粕来说，正向结构是显著的吗

对于豆粕期货而言，**正向市场结构（近月合约价格 > 远月合约价格）是其长期且较为显著的特征**，但这种显著性并非绝对，会受短期供需、政策、成本等因素影响出现阶段性偏离，需结合具体市场环境分析。

要理解豆粕正向结构的 “显著性”，需先明确其核心驱动逻辑，再结合历史规律与特殊场景的变化展开：

## 一、先明确：正向市场结构的本质

期货市场的 “正向结构”（Contango，也常被称为 “升水结构”，此处需注意：“升水 / 贴水” 是相对概念 —— 近月对远月升水，即远月对近月贴水），**本质是现货与期货的 “持有成本” 在合约价格上的体现**。

对商品而言，持有成本包括：仓储费、保险费、资金占用利息（机会成本）、物流成本等。当市场供需相对平稳时，远月合约价格需要覆盖 “从现在到远月交割日” 的持有成本，因此理论上远月价格应高于近月 —— 但豆粕的特殊性在于，其 **供给稳定性” 和 “消费即时性” 共同逆转了这一理论逻辑，使正向结构成为常态**。

## 二、豆粕正向结构 “显著” 的核心原因（长期逻辑）

豆粕作为 “大豆压榨的直接副产品”，其供给和消费特性决定了长期正向结构的必然性，这也是其与原油、黄金等 “长期反向结构（Backwardation）” 商品的核心差异：

1. **供给端：大豆进口依赖 + 压榨产能稳定，豆粕供给 “短多长空”**
豆粕的供给完全依赖大豆压榨（大豆→豆粕 + 豆油），而我国大豆 80% 以上依赖进口（主要来自美国、巴西、阿根廷），进口大豆的到港节奏和压榨产能相对稳定，导致**豆粕短期供给 “有保障”，但长期供给受种植季、贸易政策等影响存在不确定性（反而容易被市场提前 “折价”）**：

- 近月合约：对应 “已到港大豆的压榨产出”，供给明确、库存可查，价格更贴近当前现货供需（若现货偏紧，近月价格易走高）；
- 远月合约：对应 “未来几个月的大豆进口与压榨”，需承担 “种植天气风险、贸易关税变动、海运延误” 等不确定性，市场为规避这些风险，往往会对远月合约 “提前折价”（即远月价格低于近月）。

2. **消费端：需求即时性强，长期需求 “可替代 + 弹性低”**
豆粕的核心消费是饲料养殖（占比约 85%，主要用于猪、鸡、水产养殖），消费具有 “即时性” 和 “弱弹性” 特征：

- 即时性：养殖企业需按存栏量采购豆粕，无法大量囤积（豆粕保质期约 3-6 个月，长期储存成本高），因此近月合约的 “消费需求” 更刚性，价格支撑强；
- 长期弹性低：若远月豆粕价格过高，养殖企业可通过 “添加杂粕（如棉籽粕、菜籽粕）替代豆粕”，或减少存栏量降低需求，导致远月合约的 “需求支撑弱于近月”，价格易被压低。

3. **仓储与交割：豆粕 “储存成本高 + 交割不活跃”，进一步强化正向结构**

豆粕作为蛋白类商品，储存需防潮、防霉变，仓储成本（约 15-20 元 / 吨 / 月）显著高于原油、金属等商品；同时，豆粕期货的 “实物交割量占比极低”（大部分交易为投机或套保，最终通过平仓了结），市场更关注 “短期现货价格” 而非 “长期持有成本”，导致远月合约缺乏 “成本支撑”，价格易低于近月。

## 三、正向结构的 “非绝对性”：哪些场景会出现阶段性偏离？

豆粕的正向结构虽长期显著，但并非 “永远不变”，在以下特殊场景下，可能出现**反向结构（近月 < 远月，即 Backwardation）** 或 “结构扁平化”：

|场景类型	|核心原因	|案例（历史参考）|
|---|---|---|
|短期供给突发短缺|	大豆进口延迟（如海运受阻、贸易政策收紧）、压榨厂集中检修导致豆粕短期产能下降，近月供给骤减，价格飙升超过远月|	2020 年疫情初期：海运停滞 + 压榨厂停工，豆粕近月合约价格一度比远月高 500 元 / 吨以上|
|长期需求爆发预期|	养殖行业大规模补栏（如猪价上涨带动生猪存栏激增），市场预期未来豆粕需求大幅增长，远月价格被提前炒作|	2021 年下半年：生猪存栏恢复至疫情前水平，豆粕远月合约价格短暂超过近月|
|极端天气影响供给|	大豆主产国（如巴西、美国）遭遇干旱、暴雨等灾害，市场预期未来大豆减产→豆粕供给减少，远月价格抬升	|2023 年夏季：美国中西部干旱，大豆减产预期下，豆粕远月合约价格阶段性高于近月|

## 四、结论：豆粕正向结构 “长期显著，短期可波动”

综合来看：

- 长期维度（1 年以上） ：受 “大豆进口稳定 + 豆粕消费即时性 + 储存成本高” 的核心逻辑驱动，豆粕期货的正向结构（近月 > 远月）是常态且显著的，这也是 “移仓换月策略能持续获取贴水补偿” 的底层基础；
- 短期维度（1-3 个月） ：若出现突发供给短缺、需求爆发或极端天气，可能阶段性转为反向结构，但这种偏离通常是 “暂时的”—— 当供需矛盾缓解后，结构会逐步回归正向。

对于交易或策略设计而言，需通过跟踪 “大豆到港量、压榨开机率、养殖存栏数据、主产国天气” 等高频指标，判断当前结构是否处于 “常态正向” 或 “阶段性偏离”，从而更精准地把握移仓收益机会。

# 豆粕期货为什么没有2.4.6月的

豆粕期货没有 2、4、6 月合约，主要是受豆粕的生产、消费特点以及市场交易活跃度等因素影响。具体如下：

- **季节性生产和消费因素**：2 月份通常处于春节期间，4 月份有清明节，市场交易活跃度较低，且此时豆粕生产、消费相对较少。6 月份是传统的 “淡季”，气温较高且多雨，豆粕在高温高湿环境下容易发生霉变，加工企业往往会大量减产或停工，导致豆粕供求出现较大缺口，市场交易也不活跃。
- **与大豆期货合约月份对应**：我国大多农产品期货都是单月合约，包括大豆期货。交易所在设置豆粕期货的合约时，将豆粕期货的合约月份与大豆期货的合约月份相对应，便于两种不同期货市场的流通，增加交易活跃度。
- **降低交割风险**：6 月等月份由于天气等原因，豆粕储存难度大，质量难以保证，设置这些月份的合约会增加交割时的风险和纠纷，不利于期货市场的平稳运行。而大连商品交易所设定的 1 月、3 月、5 月、7 月、8 月、9 月、11 月和 12 月等合约月份，能更好地避开这些问题，保障期货交易的顺利进行。